# Dockerfile для разработки с hot-reload
FROM node:22

# Устанавливаем рабочую директорию
WORKDIR /usr/src/app

# Копируем package.json и package-lock.json
COPY package*.json ./

# Копируем prisma схему и конфигурацию
COPY prisma ./prisma
COPY prisma.config.ts ./

# Устанавливаем зависимости
RUN npm install

# Копируем остальные файлы конфигурации
COPY nest-cli.json tsconfig*.json ./

# Создаем пустую директорию dist для сборки
# Это предотвращает ошибки при первом запуске NestJS watch mode
RUN mkdir -p dist

# В dev режиме не копируем src - он будет смонтирован как volume
# Это позволяет hot-reload работать без пересборки образа

EXPOSE 3000

# Команда по умолчанию (можно переопределить в docker-compose)
CMD ["npm", "run", "start:dev"]

